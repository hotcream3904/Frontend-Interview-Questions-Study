# Event Loop 란?

자바스크립트에서 Event Loop란? 싱글 스레드 환경에서 동작하는 JavaScript 엔진의 핵심 개념 중 하나로, 콜 스택(Call Stack), 백그라운드(Background), 태스크 큐(Task Queue)와 같은 컴포넌트들로 구성되어 있다.
언어 자체는 싱글스레드이지만, 자바스크립트가 동작하는 브라우저위에는 여러가지 스레드가 들어있다. 브라우저의 Renderer Process 에 존재하는 Main Thread가 바로 우리가 흔히 아는 자바스크립트의 싱글 스레드이며 그 이외에도 다양한 스레드가 존재한다.

## 1. 자바스크립트 엔진

- webkit, V8, ...
- 자바스크립트 코드를 해석하고 실행하는 인터프리터
- 메모리 힙(Heap) + 콜 스택(Call Stack) 으로 이루어져 있음
- 힙(Heap)은 메모리 할당이 일어나는 부분(변수, 객체 등이 저장되는 일종의 창고)
- 콜 스택은 스택[LIFO(Last In First Out)]의 자료구조를 가지고 있어 나중에 쌓인 함수가 가장 먼저 종료됨

## 2.


---
교훈
stack과 queue를 바쁘게 하지 말자. 버튼 하나에 많은 기능을 담으면 안된다. 이벤트리스너 많이 금지.
setTimeout, 이벤트리스너, ajax 함수쓰면 비동기적 가능하다.

---

## 단어

### **1. 프로세스**
- Operation System 즉 운영체제의 메모리 위에서 실행되고 있고 각각 독립적이다. 프로세스마다 할당된 데이터나 메모리가 정해져있다.

- Process의 구조 : Code, Stack, Heap, Data

### **2. 스레드**
- 동시에 수행될 수 있는 작은 일꾼 단위이다. process 안에 여러개가 들어있고, 그 안에는 Stack 이 지정되어 있지만, code나 heap, data는 process에 한개씩 들어있다.

### **3. 스택**
- 자료구조 중 하나로, Last In First Out 즉 LIFO 라고 불리우는 구조이다. 나중에 쌓인 함수가 가장 먼저 종료되고, 가장 먼저 들어간 함수가 마지막으로 종료된다.

### **4. 큐**
- 자료구조 중 하나로, First In First Out 즉 FIFO 라고 불리우는 구조이다. 먼저 들어간 함수가 먼저 콜 스택으로 이동된다.





60 fps 가 되도록  만들어라!


태스크 큐에 쌓인다. 콜백함수를 특정한 이벤트가 발생했을때 이 곳에 넣고, 이벤트루프는 콜스택이 끝나면 태스크 큐에 있는 아이들을 콜스택으로 옮긴다.

마이크로테스크 큐는 promise 함수의 콜백이 등록되고!

이벤트루프가 한바퀴 도는데는 1ms 도 걸리지 않음. 그래서 render 에는 갈수도 있고, 몇바퀴 돌다가 render tree를 업데이트 했다가 나중에 업데이트하는식으로 운영!

그리고 Microtask Queue 에 있는 친구들을 Call Stack 으로 데리고 가서 실행시킨다. 아이템이 없어질때까지, 새로 들어오는 아이들도 모두 기다려서 끝낸 반면에

Task Queue 에서는 하나의 아이만 call stack 에 데려가서 끝낸다음 다시 순회를 시작한다.


Call Stack 에 등록될 콜백함수는 최대한 간단하게 작성, 재귀함수나 while, for문은 조심해서 사용하는게 좋다!


마이크로 테스크큐와 태스크 큐의 차이점!

큐 태스크에 콜백함수가 쏙 들어오면 언젠가 콜스택으로 가게되고 콜스택에서 콜백함수가 실행되게 되면 다시 핸들클릭을 부르기때문에 다시 큐에 들어오고 계속해서 반복된다.

큐 태스크에 쌓이다가 하나씩 콜스택으로 가게되다가 렌더링쪽으로도 이벤트루프가 가기때문에 렌더링이 일어나는 걸 확인할 수 있다.


----


## 참고

- [youtube, [10분 테코톡] 피터의 이벤트루프](https://www.youtube.com/watch?v=wcxWlyps4Vg)
- [youtube, [10분 테코톡] 병민의 브라우저의 Event Loop](https://www.youtube.com/watch?v=YpQTeIqjC4o)
- [유료강의, 드림코딩 - 브라우저 101 EventLoop]